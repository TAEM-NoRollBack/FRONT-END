<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ê²Œì‹œíŒ</title>
    <style>
      :root {
        --pink: #ff83a2;
        --pink-soft: #ffcdda;
        --line: #d9d9d9;
        --text: #000;
        --muted: #777;
      }
      html,
      body {
        margin: 0;
        height: 100%;
        background: #fff;
        font-family: Pretendard, -apple-system, BlinkMacSystemFont, 'Segoe UI',
          Roboto, Arial, sans-serif;
      }
      /* ì‹œì•ˆ ìƒë‹¨ë°” */
      .phone {
        width: 393px;
        height: 852px;
        margin: 0 auto;
        position: relative;
        overflow: hidden;
        background: #fff;
      }
      .topbar {
        position: absolute;
        left: 0;
        right: 0;
        top: -17px;
        height: 81px;
        background: var(--pink);
        border-bottom-left-radius: 10px;
        border-bottom-right-radius: 10px;
      }
      .time {
        position: absolute;
        left: 35px;
        top: 15px;
        width: 61px;
        height: 39px;
        text-align: center;
        color: #000;
        font-size: 20px;
        font-weight: 700;
        line-height: 38.64px;
      }
      .pill {
        position: absolute;
        left: 144px;
        top: 17px;
        width: 105px;
        height: 30px;
        background: #000;
        border-radius: 15px;
      }
      .title {
        position: absolute;
        left: 173px;
        top: 78px;
        color: #000;
        font-size: 18px;
        line-height: 38.64px;
      }
      /* í•˜íŠ¸ on/off */

      /* ëŒ“ê¸€ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ */
      .comment-dim {
        position: fixed;
        inset: 0;
        display: none;
        align-items: flex-end;
        background: rgba(0, 0, 0, 0.35);
        z-index: 1001;
      }
      .comment-dim.open {
        display: flex;
      }
      /* Heart/Comment ì•„ì´ì½˜ í¬ê¸° ê³ ì • */
      .actions .heart svg {
        width: 18px;
        height: 16px;
        flex-shrink: 0;
      }
      /* ì•„ì´ì½˜ í¬ê¸°ë§Œ ê³ ì • */
      .actions .heart svg {
        width: 18px;
        height: 16px;
        flex-shrink: 0;
      }
      .actions .comment svg {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }

      /* í•˜íŠ¸ ê¸°ë³¸(ë¹„í™œì„±) ì„  ìŠ¤íƒ€ì¼ */
      .comment-drawer {
        width: 100%;
        max-width: 393px;
        margin: 0 auto;
        background: #fff;
        border-top-left-radius: 14px;
        border-top-right-radius: 14px;
        transform: translateY(100%);
        transition: transform 0.25s ease;
        box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.15);
      }
      .comment-dim.open .comment-drawer {
        transform: translateY(0);
      }

      .c-head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        border-bottom: 1px solid var(--line);
        font-weight: 700;
      }
      .c-head .c-close {
        border: 0;
        background: transparent;
        font-size: 16px;
        color: #666;
        cursor: pointer;
      }

      .c-list {
        max-height: 45vh;
        overflow: auto;
        padding: 12px 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .c-item {
        display: flex;
        gap: 8px;
        align-items: flex-start;
      }
      .c-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #d9d9d9;
        flex: 0 0 32px;
      }
      .c-bubble {
        background: #f7f7f7;
        border-radius: 12px;
        padding: 8px 10px;
      }
      .c-meta {
        font-size: 11px;
        color: #555;
        margin-bottom: 4px;
      }
      .c-text {
        font-size: 14px;
        line-height: 1.4;
        word-break: break-word;
      }

      .c-form {
        display: flex;
        gap: 8px;
        padding: 10px 12px;
        border-top: 1px solid var(--line);
      }
      .c-form input {
        flex: 1;
        border: 1px solid var(--line);
        border-radius: 8px;
        padding: 10px 12px;
        font-size: 14px;
      }
      .c-form button {
        background: var(--pink);
        color: #fff;
        border: 0;
        border-radius: 8px;
        padding: 0 14px;
        font-weight: 600;
        cursor: pointer;
      }

      /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ (ê¸€ì“°ê¸° í˜ì´ì§€ì™€ ë™ì¼ ìœ„ì¹˜ ëŠë‚Œ) */
      .back {
        position: absolute;
        left: 12px;
        top: 78px;
        background: none;
        border: 0;
        appearance: none; /* all:unset ì œê±° */
        cursor: pointer;
        color: #000;
        font-size: 18px;
        font-family: inherit;
        line-height: 1; /* ê¸€ì ë³´ì´ê²Œ */
        padding: 6px 8px;
        border-radius: 8px;
        z-index: 5; /* ê²¹ì¹¨ ë°©ì§€ìš© */
      }
      .back:focus {
        outline: 2px solid rgba(0, 0, 0, 0.2);
        outline-offset: 2px;
      }

      .banner {
        position: absolute;
        left: 50%;
        top: 138px; /* ê¸°ì¡´ ìë¦¬ ìœ ì§€ */
        transform: translateX(-50%);
        width: 319px;
        height: 82px;
        flex-shrink: 0;
        border-radius: 8px;
        background: #ffe2ea; /* mypageì™€ ë™ì¼ */
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 0 14px;
        cursor: pointer; /* ì „ì²´ ì˜ì—­ í´ë¦­ */
      }
      .banner .promo-icon {
        width: 35px;
        height: 35px;
        border-radius: 6px;
        background: url('board.png') 50% / cover no-repeat;
        flex-shrink: 0;
      }

      .banner .promo-text {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .banner .promo-title {
        color: #000;
        text-align: center;
        font-family: Pretendard;
        font-size: 14px;
        font-weight: 600;
        line-height: 38.644px; /* mypageì™€ ë™ì¼ ìˆ˜ì¹˜ */
        margin: 0;
      }

      .banner .promo-sub {
        color: #000;
        font-family: Pretendard;
        font-size: 11px;
        font-weight: 400;
        line-height: 38.644px;
        margin: -6px 0 0;
      }

      .banner .promo-coin {
        position: absolute;
        right: 10px;
        bottom: 8px;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: url('coin.png') 50% / cover no-repeat;
        flex-shrink: 0;
      }

      /* ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ ì˜ì—­ */
      .scroll {
        position: absolute;
        left: 0;
        right: 0;
        top: 230px;
        bottom: 0;
        overflow: auto;
        scroll-behavior: smooth;
        padding: 0 16px 92px;
      }
      .divider {
        height: 2px;
        background: #d9d9d9;
        margin: 12px 0;
      }

      /* í¬ìŠ¤íŠ¸ ì¹´ë“œ */
      .post {
        position: relative;
        border-bottom: 1px solid var(--line);
        padding: 18px 6px 14px;
      }
      .post:last-child {
        border-bottom: none;
      }
      .post-head {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
      }
      .avatar {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: #d9d9d9;
        flex: 0 0 38px;
      }
      .who {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }
      .name {
        font-size: 12px;
        font-weight: 500;
      }
      .ago {
        font-size: 10px;
        color: #555;
      }
      .more {
        position: absolute;
        right: 0;
        top: 14px;
        width: 24px;
        height: 28px;
        border: none;
        background: transparent;
        cursor: pointer;
      }
      .more i {
        display: block;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: #c9c9c9;
        margin: 3px auto;
      }
      .title2 {
        font-size: 18px;
        font-weight: 600;
        margin: 2px 0 8px;
      }
      .content {
        font-size: 14px;
        line-height: 21px;
        margin-bottom: 10px;
      }

      /* ì‚¬ì§„ ê·¸ë¦¬ë“œ(ìµœëŒ€ 5) */
      .photos {
        display: grid;
        gap: 6px;
        margin-bottom: 12px;
      }
      .photos img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 6px;
        background: #d9d9d9;
      }
      .p-1 {
        grid-template-columns: 1fr;
        grid-auto-rows: 220px;
      }
      .p-2 {
        grid-template-columns: 1fr 1fr;
        grid-auto-rows: 170px;
      }
      .p-3 {
        grid-template-columns: 1fr 1fr;
        grid-template-areas: 'a b' 'a c';
        grid-auto-rows: 110px;
      }
      .p-3 img:nth-child(1) {
        grid-area: a;
        height: 226px;
      }
      .p-4 {
        grid-template-columns: 1fr 1fr;
        grid-auto-rows: 120px;
      }
      .p-5 {
        grid-template-columns: 1fr 1fr;
        grid-template-areas: 'a b' 'a c' 'd e';
        grid-auto-rows: 110px;
      }
      .p-5 img:nth-child(1) {
        grid-area: a;
        height: 226px;
      }
      /* í•˜ë‹¨ ì•¡ì…˜ */
      .actions {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 6px 0 2px;
      }
      .heart,
      .comment {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
      }
      .comment svg {
        width: 20px;
        height: 18px;
        stroke: var(--pink);
        fill: none;
      }
      .write-wrap {
        display: flex;
        justify-content: center;
        margin: 18px 0;
      }
      .write-btn {
        background: var(--pink-soft);
        border: none;
        border-radius: 100px;
        padding: 12px 28px;
        font-weight: 600;
        font-size: 18px;
        cursor: pointer;
        margin-bottom: 20px; /* ë°‘ìœ¼ë¡œ ì¡°ê¸ˆ ë” ë‚´ë¦¬ê¸° */
      }

      /* ì•¡ì…˜ì‹œíŠ¸(ì‹œì•ˆ ëª¨ì–‘) */
      .sheet-dim {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.35);
        z-index: 1000;
      }
      .sheet {
        width: 326px;
      }
      .sheet .box,
      .sheet .cancel {
        background: #fff;
        border: 2px solid var(--pink);
        border-radius: 10px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
      }
      .sheet .box {
        height: 136px;
      }
      .sheet .cancel {
        height: 54px;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }
      .sheet .row {
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        user-select: none;
      }
      .sheet .row + .row {
        border-top: 2px solid var(--pink);
      }
      .sheet .cancel {
        cursor: pointer;
      }
      /* ë¦¬ìŠ¤íŠ¸ê°€ ë²„íŠ¼ì— ê°€ë ¤ì§€ì§€ ì•Šê²Œ ì—¬ìœ  ì£¼ê¸°(ê¸°ì¡´ padding-bottom ë®ì–´ì”€) */
      .scroll {
        padding-bottom: 140px;
      }

      /* í•˜ë‹¨ ê³ ì •ì²˜ëŸ¼ ë³´ì´ê²Œ: ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ ê¸°ì¤€ sticky */
      .write-wrap {
        position: sticky;
        bottom: 30px;
        z-index: 30;
        display: flex;
        justify-content: center;
        margin: 0; /* ê¸°ì¡´ margin:18px 0 ë¬´ì‹œ */
        pointer-events: none; /* ë’¤ ì½˜í…ì¸  í´ë¦­ ê°€ëŠ¥ */
      }

      /* ë²„íŠ¼ë§Œ í´ë¦­ë˜ë„ë¡ */
      .write-wrap .write-btn {
        pointer-events: auto;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      }
    </style>
  </head>
  <body>
    <div class="phone" id="phone">
      <!-- ìƒë‹¨ ì‹œì•ˆ ìš”ì†Œë“¤ -->
      <div class="topbar"></div>
      <div class="title">ê²Œì‹œíŒ</div>
      <button id="btnBack" class="back" aria-label="ë’¤ë¡œê°€ê¸°">ã€ˆ</button>
      <div class="banner" id="promoBanner" aria-label="ë¦¬ë·° í”„ë¡œëª¨ì…˜">
        <div class="promo-icon" aria-hidden="true"></div>
        <div class="promo-text">
          <div class="promo-title">ë¦¬ë·° ì‘ì„±í•˜ê³  ìƒí’ˆê¶Œìœ¼ë¡œ êµí™˜í•´ìš”!</div>
          <div class="promo-sub">ë¸”ë¡œê·¸ ë¦¬ë·° 1ê±´ë‹¹ 200P ì§€ê¸‰</div>
        </div>
        <div class="promo-coin" aria-hidden="true"></div>
      </div>

      <!-- ìŠ¤í¬ë¡¤ ì˜ì—­ -->
      <div class="scroll" id="list"></div>

      <!-- ì•¡ì…˜ì‹œíŠ¸ -->
      <div class="sheet-dim" id="sheetDim" aria-hidden="true">
        <div
          class="sheet"
          role="dialog"
          aria-modal="true"
          aria-label="ê²Œì‹œê¸€ ë”ë³´ê¸°"
        >
          <div class="box">
            <div class="row" id="actEdit">ìˆ˜ì •í•˜ê¸°</div>
            <div class="row" id="actDelete">ì‚­ì œí•˜ê¸°</div>
            <div class="row" id="actShare">ê³µìœ í•˜ê¸°</div>
          </div>
          <div class="cancel" id="actCancel">ì·¨ì†Œ</div>
        </div>
      </div>
      <!-- ëŒ“ê¸€ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ -->
      <div class="comment-dim" id="cDim" aria-hidden="true">
        <aside
          class="comment-drawer"
          id="cDrawer"
          role="dialog"
          aria-modal="true"
          aria-label="ëŒ“ê¸€"
        >
          <header class="c-head">
            <strong>ëŒ“ê¸€</strong>
            <button class="c-close" id="cClose" aria-label="ë‹«ê¸°">âœ•</button>
          </header>
          <div class="c-list" id="cList"></div>
          <form class="c-form" id="cForm">
            <input
              id="cInput"
              type="text"
              placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
              maxlength="200"
            />
            <button type="submit">ë“±ë¡</button>
          </form>
        </aside>
      </div>
    </div>

    <script>
      /* === ì•„ì´ì½˜ SVG ìƒìˆ˜ === */
      /* í•˜íŠ¸(ë¹„í™œì„±) â€“ ë„¤ê°€ ì¤€ ê·¸ëŒ€ë¡œ */
      const HEART_OFF_SVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" viewBox="0 0 20 18" fill="none">
  <path d="M10 4C10 4 10 4 9.24 3C8.36 1.84 7.06 1 5.5 1C3.01 1 1 3.01 1 5.5C1 6.43 1.28 7.29 1.76 8C2.57 9.21 10 17 10 17M10 4C10 4 10 4 10.76 3C11.64 1.84 12.94 1 14.5 1C16.99 1 19 3.01 19 5.5C19 6.43 18.72 7.29 18.24 8C17.43 9.21 10 17 10 17"
    stroke="#FF83A2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>`;

      /* í•˜íŠ¸(í™œì„±/ì±„ì›Œì§) â€“ ì±„ì›Œì§„ ë²„ì „ */
      const HEART_ON_SVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="18" viewBox="0 0 20 18" fill="none">
  <path d="M10 3c0 0 0 0 .76-1C11.64.84 12.94 0 14.5 0 16.99 0 19 2.01 19 4.5c0 .93-.28 1.79-.76 2.5C17.43 8.21 10 16 10 16S2.57 8.21 1.76 7C1.28 6.29 1 5.43 1 4.5 1 2.01 3.01 0 5.5 0 7.06 0 8.36.84 9.24 2 10 3 10 3 10 3Z"
    fill="#FF83A2"/>
</svg>`;

      /* ëŒ“ê¸€ â€“ ë„¤ê°€ ì¤€ ê·¸ëŒ€ë¡œ */
      const COMMENT_SVG = `
<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
  <path d="M10.002 19C11.965 18.9996 13.8739 18.3574 15.438 17.1713C17.0021 15.9853 18.1356 14.3204 18.6656 12.4304C19.1957 10.5404 19.0934 8.52892 18.3742 6.70249C17.655 4.87606 16.3584 3.33484 14.6819 2.31369C13.0055 1.29254 11.0412 0.847472 9.08839 1.0463C7.13556 1.24513 5.30127 2.07695 3.86505 3.41501C2.42884 4.75306 1.46946 6.52398 1.13312 8.45788C0.796771 10.3918 1.10191 12.3826 2.00202 14.127L1.00202 19L5.87502 18C7.11102 18.639 8.51502 19 10.002 19Z"
    stroke="#FF83A2" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  <path d="M5.50195 10H5.51195V10.01H5.50195V10ZM10.002 10H10.012V10.01H10.002V10ZM14.502 10H14.512V10.01H14.502V10Z"
    stroke="#FF83A2" stroke-width="2.25" stroke-linejoin="round"/>
</svg>`;

      const LIKE_KEY = 'BOARD_LIKED';
      const CKEY = (id) => `BOARD_COMMENTS:${id}`;

      function loadLikes() {
        try {
          return JSON.parse(localStorage.getItem(LIKE_KEY)) || {};
        } catch {
          return {};
        }
      }
      function saveLikes(obj) {
        localStorage.setItem(LIKE_KEY, JSON.stringify(obj || {}));
      }

      function loadComments(id) {
        try {
          return JSON.parse(localStorage.getItem(CKEY(id))) || [];
        } catch {
          return [];
        }
      }
      function saveComments(id, arr) {
        localStorage.setItem(CKEY(id), JSON.stringify(arr || []));
      }

      /* ë°ëª¨ ëŒ“ê¸€(ì²˜ìŒ ë³´ê¸° ì¢‹ê²Œ) */
      function ensureDemoComments(id) {
        if (id === 'demo-1' && loadComments(id).length === 0) {
          saveComments(id, [
            {
              id: 'c1',
              author: 'ì‹œì¥íƒë°©ëŸ¬',
              text: 'ì—¬ê¸° ì§„ì§œ ë§›ë‚˜ìš”!',
              createdAt: Date.now() - 3600000,
            },
            {
              id: 'c2',
              author: 'ë¨¹ë¡œë“œ',
              text: 'ë‹¤ìŒì— ê°€ë´ì•¼ê² ì–´ìš” ğŸ˜Š',
              createdAt: Date.now() - 600000,
            },
          ]);
        }
      }

      /* ë¡œê·¸ì¸ ì´ë¦„(ì—†ìœ¼ë©´ â€˜ë‚˜â€™) */
      function getMeName() {
        try {
          const raw =
            localStorage.getItem('me') ||
            localStorage.getItem('profile') ||
            localStorage.getItem('auth.user');
          if (raw) {
            const o = JSON.parse(raw);
            const n =
              o.name ||
              o.nickname ||
              o.username ||
              localStorage.getItem('nickname') ||
              localStorage.getItem('myName') ||
              'ë‚˜';
            return (n || 'ë‚˜').toString().trim() || 'ë‚˜';
          }
        } catch {}
        const n =
          localStorage.getItem('nickname') ||
          localStorage.getItem('myName') ||
          'ë‚˜';
        return (n || 'ë‚˜').toString().trim() || 'ë‚˜';
      }

      /* XSS ì–µì œ */
      function escapeHtml(s) {
        return (s || '').replace(/[&<>"']/g, function (m) {
          return {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
          }[m];
        });
      }

      /* ============ ë°ì´í„° ì €ì¥ì†Œ ============ */
      const STORAGE_KEY = 'BOARD_POSTS';
      function loadPosts() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          const seed = [
            {
              id: 'demo-1',
              author: 'ì–‘ë™ê·¼4',
              createdAt: Date.now() - 1000 * 60 * 60 * 3,
              title: 'ê¸ˆê´‘ì‹œì¥',
              content:
                'ì˜¤ëŠ˜ì€ í•™êµê·¼ì²˜ ê¸ˆê´‘ì‹œì¥ì— ë°©ë¬¸í•´ì„œ ì¹œêµ¬ë“¤ê³¼ ê°™ì´ ì €ë…ì„ ë¨¹ì—ˆì–´ìš”. ê¸ˆê´‘ì‹œì¥ ë§›ì§‘ìœ¼ë¡œ ì†Œë¬¸ë‚œ ì—¬ê¸° ì¡±ë°œì§‘ì€ ì—­ì‹œ ì†Œë¬¸ëŒ€ë¡œ ì«„ê¹ƒí•˜ê³  ê°ì¹ ë§›ì´ ëŒ€ë°•ì´ì—ˆì–´ìš”!',
              images: [],
              likes: 7,
              comments: 3,
            },
          ];
          localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
          return seed;
        }
        try {
          return JSON.parse(raw);
        } catch {
          return [];
        }
      }
      function savePosts(arr) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(arr || []));
      }

      /* ============ ë„ìš°ë¯¸ ============ */
      function timeAgo(ts) {
        const m = Math.floor((Date.now() - ts) / 60000);
        if (m < 60) return (m || 1) + 'ë¶„ ì „';
        const h = Math.floor(m / 60);
        if (h < 24) return h + 'ì‹œê°„ ì „';
        const d = Math.floor(h / 24);
        return d + 'ì¼ ì „';
      }
      function createPhotoGrid(imgs) {
        const wrap = document.createElement('div');
        const n = Math.min(Array.isArray(imgs) ? imgs.length : 0, 5);
        wrap.className = 'photos p-' + (n || 1);
        const arr = n ? imgs.slice(0, 5) : [''];
        for (var i = 0; i < arr.length; i++) {
          const src = arr[i];
          const img = document.createElement('img');
          if (src) img.src = src;
          wrap.appendChild(img);
        }
        return wrap;
      }

      /* ============ ë Œë” ============ */
      var listEl = document.getElementById('list');
      var posts = loadPosts();

      function render() {
        if (!listEl) return;
        listEl.innerHTML = '';
        var copy = posts.slice().reverse();
        for (var i = 0; i < copy.length; i++) {
          var post = copy[i];
          var card = document.createElement('article');
          card.className = 'post';
          card.setAttribute('data-id', post.id);

          var contentHtml = (post.content || '').replace(/\n/g, '<br>');
          card.innerHTML =
            '<button class="more" aria-label="ë”ë³´ê¸°"><i></i><i></i><i></i></button>' +
            '<div class="post-head">' +
            '<div class="avatar" aria-hidden="true"></div>' +
            '<div class="who">' +
            '<div class="name">' +
            escapeHtml(post.author || 'ìµëª…') +
            '</div>' +
            '<div class="ago">' +
            timeAgo(post.createdAt) +
            '</div>' +
            '</div>' +
            '</div>' +
            '<div class="title2">' +
            escapeHtml(post.title || '') +
            '</div>' +
            '<div class="content">' +
            contentHtml +
            '</div>';

          card.appendChild(createPhotoGrid(post.images || []));

          var act = document.createElement('div');
          act.className = 'actions';
          act.innerHTML = `
  <span class="heart" title="ì¢‹ì•„ìš”">
    ${HEART_OFF_SVG}
    <span>${post.likes || 0}</span>
  </span>
  <span class="comment" title="ëŒ“ê¸€">
    ${COMMENT_SVG}
    <span>${post.comments || 0}</span>
  </span>
`;
          card.appendChild(act);

          // ìƒíƒœ ì´ˆê¸°í™”(í•˜íŠ¸ on / ëŒ“ê¸€ ìˆ˜)
          var cCount = loadComments(post.id).length;
          var cSpan = act.querySelector('.comment span');
          if (cSpan) cSpan.textContent = cCount;
          const likesMap = loadLikes();
          listEl.appendChild(card);
          if (likesMap[post.id]) {
            const h = act.querySelector('.heart');
            if (h) {
              const num = h.querySelector('span');
              h.innerHTML = HEART_ON_SVG;
              if (num) h.appendChild(num);
            }
          }
        }

        // â€˜ë¸”ë¡œê·¸ ë¦¬ë·°ì“°ê¸°â€™ ë²„íŠ¼
        var writeWrap = document.createElement('div');
        writeWrap.className = 'write-wrap';
        writeWrap.innerHTML =
          '<button class="write-btn" id="goWrite">ë¸”ë¡œê·¸ ë¦¬ë·°ì“°ê¸°</button>';
        listEl.appendChild(writeWrap);
      }

      render();

      /* ============ ì•¡ì…˜ì‹œíŠ¸ ============ */
      var sheetDim = document.getElementById('sheetDim');
      var currentId = null;

      function openSheet(id) {
        currentId = id;
        if (!sheetDim) return;
        sheetDim.style.display = 'flex';
        sheetDim.setAttribute('aria-hidden', 'false');
      }
      function closeSheet() {
        if (!sheetDim) return;
        sheetDim.style.display = 'none';
        sheetDim.setAttribute('aria-hidden', 'true');
        currentId = null;
      }

      if (listEl) {
        listEl.addEventListener('click', function (e) {
          var card = e.target.closest ? e.target.closest('.post') : null;
          var id =
            card && card.getAttribute ? card.getAttribute('data-id') : null;

          // ì¢‹ì•„ìš”
          var heartBtn = e.target.closest ? e.target.closest('.heart') : null;
          if (heartBtn && id) {
            toggleLike(id, heartBtn);
            return;
          }

          // ëŒ“ê¸€
          var cmtBtn = e.target.closest ? e.target.closest('.comment') : null;
          if (cmtBtn && id) {
            openComments(id);
            return;
          }

          // ë”ë³´ê¸° / ê¸€ì“°ê¸°
          var moreBtn = e.target.closest ? e.target.closest('.more') : null;
          var writeBtn = e.target.closest ? e.target.closest('#goWrite') : null;
          if (moreBtn && id) openSheet(id);
          else if (writeBtn) location.href = 'blog-write.html';
        });
      }

      var btnCancel = document.getElementById('actCancel');
      if (btnCancel) btnCancel.onclick = closeSheet;

      if (sheetDim) {
        sheetDim.addEventListener('click', function (e) {
          if (e.target === sheetDim) closeSheet();
        });
      }

      var btnEdit = document.getElementById('actEdit');
      if (btnEdit)
        btnEdit.onclick = function () {
          if (!currentId) return;
          location.href = 'blog-write.html?id=' + encodeURIComponent(currentId);
        };

      var btnDelete = document.getElementById('actDelete');
      if (btnDelete)
        btnDelete.onclick = function () {
          if (!currentId) return;
          if (confirm('ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí• ê¹Œìš”?')) {
            posts = posts.filter(function (p) {
              return p.id !== currentId;
            });
            savePosts(posts);
            render();
            closeSheet();
          }
        };

      var btnShare = document.getElementById('actShare');
      if (btnShare)
        btnShare.onclick = function () {
          if (!currentId) return;
          var url = location.origin
            ? location.origin + location.pathname + '#' + currentId
            : '#' + currentId;
          (async function () {
            try {
              if (navigator.share) {
                await navigator.share({
                  title: 'ê²Œì‹œê¸€ ê³µìœ ',
                  text: 'ê²Œì‹œê¸€ì„ ê³µìœ í•©ë‹ˆë‹¤',
                  url: url,
                });
              } else {
                await navigator.clipboard.writeText(url);
                alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
              }
            } catch (_) {}
            closeSheet();
          })();
        };

      var btnBack = document.getElementById('btnBack');
      if (btnBack)
        btnBack.addEventListener('click', function () {
          location.href = '../mainpage/home.html';
        });

      // ë’¤ë¡œê°€ê¸°
      var btnBack = document.getElementById('btnBack');
      if (btnBack) {
        btnBack.addEventListener('click', function () {
          location.href = '../mainpage/home.html';
        });
      }

      // ë°°ë„ˆ ì „ì²´ë¥¼ ë§í¬ì²˜ëŸ¼ ë™ì‘ (mypage promo-boxì™€ ë™ì¼)
      (function () {
        var el = document.getElementById('promoBanner');
        if (!el) return;
        var go = function () {
          location.href = '../mypage/reward.html';
        };
        el.setAttribute('role', 'link');
        el.tabIndex = 0;
        el.addEventListener('click', go);
        el.addEventListener('keydown', function (e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            go();
          }
        });
      })();

      /* ============ ì¢‹ì•„ìš” í† ê¸€ ============ */
      function toggleLike(id, heartEl) {
        var likes = loadLikes();
        var liked = !!likes[id];
        var p = null;
        for (var i = 0; i < posts.length; i++) {
          if (posts[i].id === id) {
            p = posts[i];
            break;
          }
        }
        if (!p) return;

        var num = heartEl.querySelector('span'); // ìˆ«ì span ë³´ì¡´

        if (liked) {
          delete likes[id];
          p.likes = Math.max(0, (p.likes || 0) - 1);
          heartEl.innerHTML = HEART_OFF_SVG;
          if (num) heartEl.appendChild(num);
        } else {
          likes[id] = true;
          p.likes = (p.likes || 0) + 1;
          heartEl.innerHTML = HEART_ON_SVG;
          if (num) heartEl.appendChild(num);
        }

        if (num) num.textContent = p.likes || 0;
        saveLikes(likes);
        savePosts(posts);
      }

      /* ============ ëŒ“ê¸€ íŒ¨ë„ ============ */
      var currentCommentsPostId = null;

      function renderComments(postId) {
        var list = loadComments(postId);
        var box = document.getElementById('cList');
        if (!box) return;
        box.innerHTML = '';
        for (var i = 0; i < list.length; i++) {
          var c = list[i];
          var item = document.createElement('div');
          item.className = 'c-item';
          item.innerHTML =
            '<div class="c-avatar" aria-hidden="true"></div>' +
            '<div class="c-bubble">' +
            '<div class="c-meta"><b>' +
            escapeHtml(c.author || 'ìµëª…') +
            '</b> Â· ' +
            timeAgo(c.createdAt) +
            '</div>' +
            '<div class="c-text">' +
            escapeHtml(c.text).replace(/\n/g, '<br>') +
            '</div>' +
            '</div>';
          box.appendChild(item);
        }
        box.scrollTop = box.scrollHeight;
      }

      function openComments(id) {
        currentCommentsPostId = id;
        ensureDemoComments(id);
        renderComments(id);
        var dim = document.getElementById('cDim');
        if (!dim) return;
        dim.classList.add('open');
        dim.setAttribute('aria-hidden', 'false');
        setTimeout(function () {
          var inp = document.getElementById('cInput');
          if (inp) inp.focus();
        }, 0);
      }

      function closeComments() {
        var dim = document.getElementById('cDim');
        if (!dim) return;
        dim.classList.remove('open');
        dim.setAttribute('aria-hidden', 'true');
        currentCommentsPostId = null;
      }

      var btnClose = document.getElementById('cClose');
      if (btnClose) btnClose.addEventListener('click', closeComments);

      var cDim = document.getElementById('cDim');
      if (cDim) {
        cDim.addEventListener('click', function (e) {
          if (e.target === cDim) closeComments();
        });
      }
      window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') closeComments();
      });

      var cForm = document.getElementById('cForm');
      if (cForm) {
        cForm.addEventListener('submit', function (e) {
          e.preventDefault();
          if (!currentCommentsPostId) return;
          var input = document.getElementById('cInput');
          var text = input ? input.value.trim() : '';
          if (!text) return;

          var me = getMeName();
          var list = loadComments(currentCommentsPostId);
          list.push({
            id: 'c_' + Math.random().toString(36).slice(2, 9),
            author: me,
            text: text,
            createdAt: Date.now(),
          });
          saveComments(currentCommentsPostId, list);

          // ì¹´ë“œ ëŒ“ê¸€ ìˆ«ì ê°±ì‹ 
          for (var i = 0; i < posts.length; i++) {
            if (posts[i].id === currentCommentsPostId) {
              posts[i].comments = list.length;
              break;
            }
          }
          savePosts(posts);
          var card = document.querySelector(
            '.post[data-id="' + currentCommentsPostId + '"]'
          );
          var span = card ? card.querySelector('.comment span') : null;
          if (span) span.textContent = list.length;

          if (input) input.value = '';
          renderComments(currentCommentsPostId);
        });
      }
    </script>
  </body>
</html>
